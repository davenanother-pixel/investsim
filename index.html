<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>InvestLife — Fast Investing Simulator</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#57e6c6;
    --accent2:#ffd166;
    --muted:#9aa6b2;
    --card:#0b1624;
    --buy:#2dd4bf;
    --sell:#ff6b6b;
    --action:#ffd166;
  }
  body{
    margin:0;
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(135deg,#071422 0%,#0f1724 60%);
    color:#e6f0f2;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  header{
    padding:14px 18px;
    display:flex;
    align-items:center;
    gap:16px;
    border-bottom:1px solid rgba(255,255,255,0.04);
    background:linear-gradient(90deg, rgba(8,12,20,0.4), rgba(12,16,28,0.1));
    position:sticky;
    top:0;
    z-index:5;
  }
  h1{margin:0;font-size:18px;letter-spacing:0.6px;}
  .container{display:grid;grid-template-columns:320px 1fr 320px;gap:16px;padding:18px;}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:10px;padding:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6);}
  .balance{font-size:24px;font-weight:700;color:var(--accent);}
  .sub{color:var(--muted);font-size:13px;}
  button{cursor:pointer;border:0;padding:8px 12px;border-radius:8px;font-weight:600;}
  .btn-buy{background:var(--buy);color:#062124;}
  .btn-sell{background:var(--sell);color:white;}
  .btn-action{background:var(--action);color:#042221;}
  table{width:100%;border-collapse:collapse;font-size:13px;}
  th,td{padding:8px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);}
  th{color:var(--muted);font-size:12px;}
  .small{font-size:12px;color:var(--muted);}
  .item-row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px 0;}
  .pos-list{display:flex;flex-direction:column;gap:8px;margin-top:8px;}
  .card{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:10px;border-radius:8px;}
  .market-fast{color:#ffd166;font-weight:700;}
  .stock-name{font-weight:700;}
  .muted{color:var(--muted);}
  .wide{grid-column:1/-1;}
  @media (max-width:1000px){
    .container{grid-template-columns:1fr; padding:12px;}
    .panel{margin-bottom:12px;}
  }
  input[type=number]{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;}
  .controls{display:flex;gap:8px;flex-wrap:wrap;}
  .footer{padding:12px;text-align:center;color:var(--muted);font-size:13px;}
</style>
</head>
<body>
<header>
  <img src="" alt="" style="width:40px;height:40px;border-radius:8px;background:linear-gradient(45deg,var(--accent),var(--accent2));display:inline-block;">
  <div style="flex:1">
    <h1>InvestLife — Fast Investing Simulator</h1>
    <div class="small muted">Invest, found companies, create brands, buy homes & cars — all free-play</div>
  </div>
  <div style="text-align:right">
    <div class="sub">Balance</div>
    <div class="balance" id="moneyDisplay">$0</div>
    <div class="sub">Tick speed <span id="tickMsDisplay">0</span>ms</div>
  </div>
</header>

<div class="container">
  <!-- Left panel: Actions & Purchases -->
  <div class="panel">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <div><strong>Actions</strong><div class="small muted">Quick game actions</div></div>
      <div class="small muted market-fast">FAST MARKET</div>
    </div>

    <div style="margin-top:10px" class="card">
      <div class="item-row">
        <div>
          <div class="small muted">Create Company</div>
          <div style="font-weight:700">Found a company</div>
        </div>
        <div style="text-align:right">
          <div class="small muted" id="companyCost">$50,000</div>
          <button class="btn-action" onclick="createCompany()">Found</button>
        </div>
      </div>

      <div class="item-row">
        <div>
          <div class="small muted">Create Brand</div>
          <div style="font-weight:700">Start a brand (boosts company)</div>
        </div>
        <div style="text-align:right">
          <div class="small muted" id="brandCost">$20,000</div>
          <button class="btn-action" onclick="createBrand()">Create</button>
        </div>
      </div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:8px 0;">
      <div><strong>Buy Homes</strong><div class="small muted">Provides rental income occasionally</div></div>
      <div class="pos-list" id="homesList"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:8px 0;">
      <div><strong>Buy Cars</strong><div class="small muted">Status & can slightly boost trading</div></div>
      <div class="pos-list" id="carsList"></div>

      <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:8px 0;">
      <div><strong>Upgrades</strong><div class="small muted">Automation & boosts</div></div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:6px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Hire Broker</div>
            <div class="small muted">Reduces buy spread</div>
          </div>
          <div>
            <div class="small muted">$5,000</div>
            <button class="btn-buy" onclick="buyUpgrade('broker',5000)">Hire</button>
          </div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Auto-Trader</div>
            <div class="small muted">Trades small amounts automatically</div>
          </div>
          <div>
            <div class="small muted">$12,000</div>
            <button class="btn-buy" onclick="buyUpgrade('auto',12000)">Buy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Middle: Market -->
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><strong>Market</strong><div class="small muted">Buy & sell stocks — tick is fast</div></div>
      <div class="small muted">Tick: <span id="tickLabel">500ms</span></div>
    </div>

    <div style="margin-top:10px;overflow:auto;max-height:420px">
      <table id="marketTable">
        <thead>
          <tr><th>Stock</th><th>Price</th><th>You</th><th>NPC</th><th>Actions</th></tr>
        </thead>
        <tbody id="marketBody"></tbody>
      </table>
    </div>

    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <input id="manualTicker" placeholder="Stock symbol to quick-buy" style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
      <button class="btn-buy" onclick="quickBuy()">Quick Buy</button>
      <button class="btn-sell" onclick="quickSell()">Quick Sell</button>
    </div>

    <div style="margin-top:12px" class="small muted">
      Tip: enter symbol then Quick Buy/Sell (prompts for amount). Founding companies is expensive but gives you control.
    </div>
  </div>

  <!-- Right: Portfolio & Info -->
  <div class="panel">
    <div><strong>Portfolio</strong><div class="small muted">Your assets & possessions</div></div>

    <div style="margin-top:8px" class="card">
      <div><span class="small muted">Cash</span></div>
      <div style="font-weight:800;font-size:18px;color:var(--accent)" id="cashShort">$0</div>
      <div style="margin-top:6px" class="small muted">Holdings</div>
      <div id="holdings" style="margin-top:8px"></div>
    </div>

    <div style="margin-top:12px" class="card">
      <div><strong>Your Companies & Brands</strong></div>
      <div id="companiesList" style="margin-top:8px"></div>
    </div>

    <div style="margin-top:12px" class="card">
      <div><strong>News / Events</strong></div>
      <div id="eventLog" style="margin-top:8px;max-height:160px;overflow:auto"></div>
    </div>
  </div>

  <!-- Wide bottom: Logs / Controls -->
  <div class="panel wide">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div><strong>Game Controls / Stats</strong></div>
      <div class="small muted">Market intensity: high (extreme)</div>
    </div>

    <div style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <div class="small muted">Speed (ms):</div>
      <input id="tickMs" type="number" value="500" min="100" max="2000" step="100" style="width:100px" onchange="setTick()">
      <button class="btn-action" onclick="setTick()">Set Speed</button>

      <div style="margin-left:8px" class="small muted">Market volatility:</div>
      <input id="volatility" type="number" value="0.4" min="0.05" max="1.0" step="0.05" style="width:90px" onchange="setVol()">
      <div class="small muted"> (0.4 = ±40%)</div>

      <button class="btn-buy" onclick="giveMoney(10000)">+ $10k (cheat)</button>
      <button class="btn-action" onclick="resetGame()">Reset Game</button>
    </div>

    <hr style="border:none;height:1px;background:rgba(255,255,255,0.04);margin:12px 0;">
    <div style="display:flex;gap:16px;flex-wrap:wrap">
      <div style="flex:1">
        <div class="small muted">Market ticks / second</div>
        <div id="tickPerSec" style="font-weight:700">0</div>
      </div>
      <div style="flex:1">
        <div class="small muted">Total wealth (cash + holdings)</div>
        <div id="netWorth" style="font-weight:700;color:var(--accent2)">$0</div>
      </div>
      <div style="flex:1">
        <div class="small muted">Owned homes / cars</div>
        <div id="ownedCount" style="font-weight:700">0 / 0</div>
      </div>
    </div>
  </div>
</div>

<div class="footer">Built for free-play investing — have fun building companies, brands, homes & cars!</div>

<script>
/* --------------------------
   Utility & Game variables
   --------------------------*/
let money = 5000;
let stocks = []; // {id,name,price,owned,npcOwned,companyId}
let companies = []; // {id,name,stockId,brandId}
let brands = []; // {id,name,companyId}
let homes = [];
let cars = [];
let upgrades = {broker:false,auto:false};
let nextId = 1;
let tickMs = 500;
let volatility = 0.4; // ±40% default (fast)
let tickInterval = null;
let ticks = 0;

/* --------------------------
   Price formatting helper
   --------------------------*/
function fmt(n){
  // shows commas and two decimals
  return (n).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});
}
function fmtInt(n){
  return Math.round(n).toLocaleString();
}

/* --------------------------
   Initial market setup
   --------------------------*/
function initMarket(){
  stocks = [];
  companies = [];
  brands = [];
  homes = [
    {id:1,name:"Small Apartment",price:30000,rent:200,owned:0},
    {id:2,name:"Suburban House",price:90000,rent:700,owned:0},
    {id:3,name:"Beach Villa",price:300000,rent:3000,owned:0}
  ];
  cars = [
    {id:1,name:"City Compact",price:8000,boost:0.01,owned:0},
    {id:2,name:"Luxury Sedan",price:45000,boost:0.04,owned:0},
    {id:3,name:"Sports Coupe",price:120000,boost:0.08,owned:0}
  ];

  // seed with a few NPC stocks
  for(let i=0;i<4;i++){
    let p = randomBetween(30, 400);
    stocks.push({id:nextId++, name:randSymbol("NPC"), price:p, owned:0, npcOwned: randomInt(20,80), companyId:null});
  }

  // a stable "blue chip" company for players to buy
  createCompany(true);
  updateAllDisplays();
}

/* --------------------------
   Random helpers
   --------------------------*/
function randomBetween(a,b){ return a + Math.random()*(b-a); }
function randomInt(a,b){ return Math.floor(a + Math.random()*(b-a+1)); }
function randSymbol(prefix="C"){ return prefix + Math.floor(Math.random()*900+100); }

/* --------------------------
   Display code
   --------------------------*/
function updateAllDisplays(){
  document.getElementById("moneyDisplay").innerText = "$" + fmt(money);
  document.getElementById("cashShort").innerText = "$" + fmt(money);
  document.getElementById("companyCost").innerText = "$" + fmt(50000);
  document.getElementById("brandCost").innerText = "$" + fmt(20000);
  document.getElementById("tickMsDisplay").innerText = tickMs;
  document.getElementById("tickLabel").innerText = tickMs + "ms";
  document.getElementById("tickPerSec").innerText = (1000/tickMs).toFixed(2);
  document.getElementById("tickMs").value = tickMs;
  document.getElementById("volatility").value = volatility;
  document.getElementById("tickMsDisplay").innerText = tickMs;

  // market table
  const tbody = document.getElementById("marketBody");
  tbody.innerHTML = "";
  stocks.forEach(s=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><span class="stock-name">${s.name}</span>${s.companyId?(" <span class='small muted'>("+ (companies.find(c=>c.id===s.companyId)?.name || "Co") +")</span>"):""}</td>
      <td>$${fmt(s.price)}</td>
      <td>${fmtInt(s.owned)}</td>
      <td>${fmtInt(s.npcOwned)}</td>
      <td>
        <div style="display:flex;gap:6px">
          <button class="btn-buy" onclick="buyStock(${s.id})">Buy</button>
          <button class="btn-sell" onclick="sellStock(${s.id})">Sell</button>
        </div>
      </td>
    `;
    tbody.appendChild(tr);
  });

  // holdings
  const holdings = document.getElementById("holdings");
  holdings.innerHTML = "";
  stocks.filter(s=>s.owned>0).forEach(s=>{
    const div = document.createElement("div");
    div.className="small";
    div.innerText = `${s.name}: ${fmtInt(s.owned)} shares (value $${fmt(s.owned * s.price)})`;
    holdings.appendChild(div);
  });
  if(!stocks.some(s=>s.owned>0)) holdings.innerHTML = "<div class='muted small'>You don't own any shares yet.</div>";

  // companies & brands
  const compBox = document.getElementById("companiesList");
  compBox.innerHTML = "";
  companies.forEach(c=>{
    const div = document.createElement("div");
    div.className='small';
    const s = stocks.find(x=>x.id===c.stockId);
    const brand = brands.find(b=>b.companyId===c.id);
    div.innerHTML = `<div style="display:flex;justify-content:space-between"><div><strong>${c.name}</strong>${brand?(" — "+brand.name):""}</div><div>$${fmt(s? s.price : 0)}</div></div>
      <div class="muted small">Shares: ${s?fmtInt(s.npcOwned + s.owned):0}  •  Your shares: ${s?fmtInt(s.owned):0}</div>
      <div style="margin-top:6px"><button class="btn-action" onclick="investInCompany(${c.id})">Invest in Co</button></div>`;
    compBox.appendChild(div);
  });
  if(companies.length===0) compBox.innerHTML="<div class='muted small'>No companies founded yet.</div>";

  // homes and cars lists
  const homesBox = document.getElementById("homesList");
  homesBox.innerHTML = "";
  homes.forEach(h=>{
    const el = document.createElement("div");
    el.className="item-row";
    el.innerHTML = `<div>
      <div style="font-weight:700">${h.name}</div>
      <div class="small muted">Rent: $${fmt(h.rent)} • Owned: ${h.owned}</div>
    </div>
    <div style="text-align:right">
      <div class="small muted">$${fmt(h.price)}</div>
      <div style="margin-top:6px"><button class="btn-buy" onclick="buyHome(${h.id})">Buy</button></div>
    </div>`;
    homesBox.appendChild(el);
  });

  const carsBox = document.getElementById("carsList");
  carsBox.innerHTML = "";
  cars.forEach(c=>{
    const el = document.createElement("div");
    el.className="item-row";
    el.innerHTML = `<div>
      <div style="font-weight:700">${c.name}</div>
      <div class="small muted">Trading Boost: ${(c.boost*100).toFixed(1)}% • Owned: ${c.owned}</div>
    </div>
    <div style="text-align:right">
      <div class="small muted">$${fmt(c.price)}</div>
      <div style="margin-top:6px"><button class="btn-buy" onclick="buyCar(${c.id})">Buy</button></div>
    </div>`;
    carsBox.appendChild(el);
  });

  // event log & totals
  const net = calculateNetWorth();
  document.getElementById("netWorth").innerText = "$" + fmt(net);
  document.getElementById("ownedCount").innerText = `${homes.reduce((a,b)=>a+b.owned,0)} / ${cars.reduce((a,b)=>a+b.owned,0)}`;

  // event log scrolling handled when events push
}

/* --------------------------
   Market mechanics
   --------------------------*/
function marketTick(){
  ticks++;
  // price swings
  stocks.forEach(s=>{
    // player's cars slightly increase chance/boost
    const carBoost = cars.reduce((a,b)=>a + b.owned * b.boost, 0);
    // random change with bias from NPC activity
    let r = Math.random() - 0.5;
    // apply volatility and carBoost
    let change = (r * 2) * volatility * (1 + carBoost);
    // NPC activity randomly; buys increase price slightly
    if(Math.random() < 0.45){
      // NPC buys random small amount
      let amount = randomInt(1,6);
      s.npcOwned += amount;
      change += 0.03 * (amount/3);
    }
    s.price = Math.max(0.5, s.price * (1 + change));
  });

  // occasional dividend / rent events
  if(Math.random() < 0.12){
    // choose random company to pay dividend
    const s = stocks[randomInt(0, stocks.length-1)];
    const dividend = randomBetween(0.5, 6) * (s.owned + s.npcOwned) * 0.001;
    if(dividend>0){
      money += dividend;
      pushEvent(`Dividend paid by ${s.name}: +$${fmt(dividend)}`);
    }
  }

  // rent from homes
  if(Math.random() < 0.35){
    let totalRent = homes.reduce((sum,h)=> sum + h.rent * h.owned * randomBetween(0.6,1.2),0);
    if(totalRent>0){
      money += totalRent;
      pushEvent(`Collected rent: +$${fmt(totalRent)}`);
    }
  }

  // auto-trader upgrade performs tiny trades
  if(upgrades.auto){
    autoTrade();
  }

  updateAllDisplays();
}

/* --------------------------
   Player actions
   --------------------------*/
function buyStock(stockId){
  const s = stocks.find(x=>x.id===stockId);
  if(!s) return;
  // buy 1 share by default, cost = price (+ small spread if no broker)
  const spread = upgrades.broker ? 0 : 0.02; // 2% spread if no broker
  const cost = s.price * (1 + spread);
  if(money < cost) return alert("Not enough money to buy 1 share!");
  money -= cost;
  s.owned += 1;
  pushEvent(`Bought 1 share of ${s.name} for $${fmt(cost)}`);
  updateAllDisplays();
}

function sellStock(stockId){
  const s = stocks.find(x=>x.id===stockId);
  if(!s) return;
  const totalAvailable = s.owned + s.npcOwned;
  if(totalAvailable<=0) return alert("No shares available to sell!");
  let qty = prompt(`How many shares do you want to sell?\nYou own: ${s.owned} • NPC own: ${s.npcOwned}\n(Enter number)`);
  qty = parseInt(qty);
  if(isNaN(qty) || qty<=0) return;
  if(qty > totalAvailable) return alert("Not enough shares available!");
  // sell player's shares first
  const fromPlayer = Math.min(s.owned, qty);
  s.owned -= fromPlayer;
  const remaining = qty - fromPlayer;
  if(remaining > 0) s.npcOwned -= remaining;
  // receive price (no spread on sell)
  const gain = s.price * qty;
  money += gain;
  pushEvent(`Sold ${qty} shares of ${s.name} for $${fmt(gain)}`);
  updateAllDisplays();
}

/* quick UI helpers */
function quickBuy(){
  const sym = document.getElementById("manualTicker").value.trim();
  if(!sym) return alert("Enter symbol to buy (e.g., NPC123 or STK555)");
  const s = stocks.find(x=>x.name.toLowerCase()===sym.toLowerCase());
  if(!s) return alert("Stock not found.");
  buyStock(s.id);
}
function quickSell(){
  const sym = document.getElementById("manualTicker").value.trim();
  if(!sym) return alert("Enter symbol to sell");
  const s = stocks.find(x=>x.name.toLowerCase()===sym.toLowerCase());
  if(!s) return alert("Stock not found.");
  sellStock(s.id);
}

/* --------------------------
   Found company & brand
   --------------------------*/
function createCompany(seed=false){
  const cost = 50000;
  if(!seed && money < cost) return alert("Need $" + fmt(cost) + " to found a company!");
  if(!seed) money -= cost;

  const companyName = "Co" + Math.floor(Math.random()*9000+1000);
  // when founding, create a new stock with more shares (you start with a few shares)
  const startPrice = randomBetween(100, 800);
  const s = {id: nextId++, name: companyName.substring(0,6).toUpperCase(), price: startPrice, owned: seed?0:10, npcOwned: randomInt(50,200), companyId:null};
  stocks.push(s);
  const cid = companies.length + 1;
  companies.push({id:cid, name:companyName, stockId:s.id, brandId:null});
  s.companyId = cid;
  pushEvent(seed?`Seeded company ${companyName}`:`Founded company ${companyName} (you own 10 shares)`);
  updateAllDisplays();
}

function createBrand(){
  const cost = 20000;
  if(money < cost) return alert("Need $" + fmt(cost) + " to create a brand!");
  money -= cost;
  if(companies.length===0){
    pushEvent("Created a brand but no companies exist — brand will be unlinked until you found a company.");
    brands.push({id:brands.length+1, name:"Brand"+Math.floor(Math.random()*900), companyId:null});
  } else {
    const company = companies[randomInt(0, companies.length-1)];
    const b = {id:brands.length+1, name: "Brand"+Math.floor(Math.random()*900), companyId:company.id};
    brands.push(b);
    company.brandId = b.id;
    pushEvent(`Created brand ${b.name} for ${company.name}`);
    // small positive effect: increase company's stock price slightly
    const s = stocks.find(x=>x.id===company.stockId);
    if(s) s.price *= 1.12;
  }
  updateAllDisplays();
}

/* invest directly in a company (buy large chunk) */
function investInCompany(companyId){
  const c = companies.find(x=>x.id===companyId);
  if(!c) return;
  const s = stocks.find(x=>x.id===c.stockId);
  const amt = prompt(`How many shares do you want to buy of ${s.name}? (You have $${fmt(money)})`);
  const qty = parseInt(amt);
  if(isNaN(qty)||qty<=0) return;
  const cost = qty * s.price;
  if(cost > money) return alert("Not enough cash.");
  money -= cost;
  s.owned += qty;
  pushEvent(`Invested $${fmt(cost)} in ${c.name}, bought ${qty} shares.`);
  updateAllDisplays();
}

/* --------------------------
   Homes & Cars purchases
   --------------------------*/
function buyHome(id){
  const h = homes.find(x=>x.id===id);
  if(!h) return;
  if(money < h.price) return alert("Not enough money for that home.");
  money -= h.price;
  h.owned += 1;
  pushEvent(`Bought ${h.name} for $${fmt(h.price)}`);
  updateAllDisplays();
}

function buyCar(id){
  const c = cars.find(x=>x.id===id);
  if(!c) return;
  if(money < c.price) return alert("Not enough money for that car.");
  money -= c.price;
  c.owned += 1;
  pushEvent(`Bought ${c.name} for $${fmt(c.price)}`);
  updateAllDisplays();
}

/* --------------------------
   Upgrades
   --------------------------*/
function buyUpgrade(key, cost){
  if(upgrades[key]) return alert("Already purchased.");
  if(money < cost) return alert("Not enough money.");
  money -= cost;
  upgrades[key] = true;
  pushEvent(`Bought upgrade: ${key}`);
  updateAllDisplays();
}

/* --------------------------
   Auto trader
   --------------------------*/
function autoTrade(){
  // buys/sells tiny amounts based on simple momentum
  if(stocks.length===0) return;
  const s = stocks[randomInt(0, stocks.length-1)];
  // 50% chance buy or sell
  if(Math.random() < 0.5){
    // buy 1 share if cheap
    if(money > s.price * 1.1){
      money -= s.price;
      s.owned += 1;
      pushEvent(`Auto-trader bought 1 ${s.name}`);
    }
  } else {
    // sell 1 if owned
    if(s.owned > 0 && Math.random()<0.4){
      s.owned -= 1;
      money += s.price;
      pushEvent(`Auto-trader sold 1 ${s.name}`);
    }
  }
}

/* --------------------------
   Events & UI helpers
   --------------------------*/
function pushEvent(text){
  const el = document.getElementById("eventLog");
  const div = document.createElement("div");
  div.className = 'small';
  div.innerText = `[${new Date().toLocaleTimeString()}] ${text}`;
  el.prepend(div);
  // keep log reasonable
  while(el.children.length > 60) el.removeChild(el.lastChild);
}

/* --------------------------
   Tick control
   --------------------------*/
function startTicks(){
  if(tickInterval) clearInterval(tickInterval);
  tickInterval = setInterval(marketTick, tickMs);
}
function setTick(){
  const val = parseInt(document.getElementById("tickMs").value);
  if(isNaN(val) || val < 100) return alert("Tick must be >= 100ms");
  tickMs = val;
  startTicks();
  updateAllDisplays();
}
function setVol(){
  const v = parseFloat(document.getElementById("volatility").value);
  if(isNaN(v) || v<=0) return alert("Invalid volatility");
  volatility = v;
}

/* --------------------------
   Utilities & admin
   --------------------------*/
function giveMoney(x){
  money += x;
  pushEvent(`Cheat: +$${fmt(x)}`);
  updateAllDisplays();
}
function resetGame(){
  if(!confirm("Reset game and lose progress?")) return;
  money = 5000;
  nextId = 1;
  ticks = 0;
  upgrades = {broker:false,auto:false};
  initMarket();
  startTicks();
  pushEvent("Game reset.");
}

/* --------------------------
   Net worth calc
   --------------------------*/
function calculateNetWorth(){
  let holdings = stocks.reduce((sum,s)=> sum + (s.owned * s.price), 0);
  let homesVal = homes.reduce((sum,h)=> sum + h.price * h.owned, 0);
  let carsVal = cars.reduce((sum,c)=> sum + c.price * c.owned, 0);
  return money + holdings + homesVal + carsVal;
}

/* --------------------------
   Init
   --------------------------*/
initMarket();
updateAllDisplays();
startTicks();

/* expose a couple functions for console debugging */
window.buyStock = buyStock;
window.sellStock = sellStock;
window.createCompany = createCompany;
window.createBrand = createBrand;
window.buyHome = buyHome;
window.buyCar = buyCar;
window.resetGame = resetGame;
</script>
</body>
</html>
